<div class="page-header">
  <h1 class="pageName">مناقصه‌های شهرداری</h1>
  <div class="actionBar">
    <label class="include-expired-toggle">
      <span>نمایش مناقصه‌های منقضی</span>
      <nz-switch [ngModel]="includeExpired" (ngModelChange)="toggleIncludeExpired($event)"></nz-switch>
    </label>
    <button nz-button nzType="primary" (click)="addRow()">ثبت مناقصه جدید</button>
  </div>
</div>

<nz-table nzShowSizeChanger [nzData]="list" [nzFrontPagination]="false" [nzLoading]="loading" [nzTotal]="total"
  [nzPageSize]="pageSize" [nzPageIndex]="pageIndex" (nzQueryParams)="onQueryParamsChange($event)">
  <thead>
    <tr>
      <th nzColumnKey="Id" [nzSortFn]="true">شناسه</th>
      <th nzColumnKey="Title">عنوان</th>
      <th nzColumnKey="Description">توضیحات</th>
      <th nzColumnKey="BeginDate">تاریخ شروع</th>
      <th nzColumnKey="EndDate">تاریخ پایان</th>
      <th nzColumnKey="FromPrice">حداقل قیمت</th>
      <th nzColumnKey="ToPrice">حداکثر قیمت</th>
      <th nzColumnKey="MinPriceOffer">کمترین قیمت پیشنهادی</th>
      <th nzColumnKey="UsersCount">تعداد شرکت‌کنندگان</th>
      <th>عملیات</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let data of list">
      <td>{{ data.Id }}</td>
      <td>{{ data.Title }}</td>
      <td>{{ data.Description }}</td>
      <td>{{ data.BeginDate | date: 'yyyy-MM-dd' }}</td>
      <td>{{ data.EndDate | date: 'yyyy-MM-dd' }}</td>
      <td>{{ data.FromPrice | number }}</td>
      <td>{{ data.ToPrice | number }}</td>
      <td>{{ data.Report.MinPriceOffer | number }}</td>
      <td>{{ data.Report.UsersCount | number }}</td>
      <td class="actions">
        <button nz-button nzType="link" (click)="editRow(data)">ویرایش</button>
        <button nz-button nzType="link" (click)="openReport(data.Id)">گزارش</button>
        <button nz-button nzType="link" nz-popconfirm nzPopconfirmTitle="آیا از حذف این مناقصه مطمئن هستید؟"
          (nzOnConfirm)="deleteRow(data.Id)" nzCancelText="انصراف" nzOkText="حذف">
          حذف
        </button>
      </td>
    </tr>
  </tbody>
</nz-table>

<form nz-form [formGroup]="validateForm">
  <nz-modal [(nzVisible)]="isEditModalVisible" nzTitle="مناقصه" nzOkText="ذخیره" nzCancelText="انصراف"
    [nzOkLoading]="loading" (nzOnOk)="submitForm()" (nzOnCancel)="isEditModalVisible = false" nzDirection="rtl">
    <ng-container *nzModalContent>
      <nz-form-item>
        <nz-form-label [nzSm]="8" [nzXs]="24" nzRequired>عنوان</nz-form-label>
        <nz-form-control [nzSm]="16" [nzXs]="24">
          <input type="text" nz-input formControlName="Title" placeholder="عنوان مناقصه" />
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSm]="8" [nzXs]="24" nzRequired>توضیحات</nz-form-label>
        <nz-form-control [nzSm]="16" [nzXs]="24">
          <textarea formControlName="Description" nz-input rows="3" placeholder="توضیحات مناقصه"></textarea>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSm]="8" [nzXs]="24" nzRequired>تاریخ شروع</nz-form-label>
        <nz-form-control [nzSm]="16" [nzXs]="24">
          <nz-date-picker formControlName="BeginDate" nzPlaceHolder="انتخاب تاریخ"></nz-date-picker>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSm]="8" [nzXs]="24" nzRequired>تاریخ پایان</nz-form-label>
        <nz-form-control [nzSm]="16" [nzXs]="24">
          <nz-date-picker formControlName="EndDate" nzPlaceHolder="انتخاب تاریخ"></nz-date-picker>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSm]="8" [nzXs]="24" nzRequired>حداقل قیمت</nz-form-label>
        <nz-form-control [nzSm]="16" [nzXs]="24">
          <nz-input-number formControlName="FromPrice" [nzMin]="0" [nzMax]="999999999" [nzStep]="1000"
            style="width: 200px"></nz-input-number>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSm]="8" [nzXs]="24" nzRequired>حداکثر قیمت</nz-form-label>
        <nz-form-control [nzSm]="16" [nzXs]="24">
          <nz-input-number formControlName="ToPrice" [nzMin]="0" [nzMax]="999999999" [nzStep]="1000"
            style="width: 200px"></nz-input-number>
        </nz-form-control>
      </nz-form-item>
    </ng-container>
  </nz-modal>
</form>