<div class="report-container">
  <form nz-form [formGroup]="filterForm" (ngSubmit)="loadReport()" class="filter-form">
    <nz-form-item>
      <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>Tender</nz-form-label>
      <nz-form-control [nzSm]="18" [nzXs]="24">
        <nz-select
          formControlName="TenderId"
          nzPlaceHolder="Select a tender"
          [nzLoading]="loadingTenders"
          nzShowSearch
          nzAllowClear
          
        >
          <nz-option
            *ngFor="let tender of tenders"
            [nzValue]="tender.Id"
            [nzLabel]="tender.Title + ' (#' + tender.Id + ')'"
          ></nz-option>
        </nz-select>
      </nz-form-control>
    </nz-form-item>
    <button nz-button nzType="primary" [disabled]="filterForm.invalid || loadingReport">Load report</button>
  </form>

  <nz-card class="summary-card" *ngIf="report">
    <nz-card-meta
      nzTitle="Tender summary"
      [nzDescription]="'Participants: ' + (report?.UsersCount ?? 0) + ' | Lowest offer: ' + (report?.MinPriceOffer ?? 0)"
    ></nz-card-meta>
    <div class="winner" *ngIf="report?.Winner; else noWinner">
      <strong>Winner:</strong>
      {{ report?.Winner?.Username || ('Contractor #' + report?.Winner?.UserId) }}
      — {{ report?.Winner?.PriceOffer | number }}
    </div>
    <ng-template #noWinner>
      <div class="winner">
        <strong>Winner:</strong> Not determined yet
      </div>
    </ng-template>
  </nz-card>

  <nz-skeleton *ngIf="loadingReport" [nzActive]="true"></nz-skeleton>
  <nz-empty *ngIf="!loadingReport && !report" nzNotFoundContent="Select a tender to view the report"></nz-empty>

  <nz-table
    *ngIf="report && !loadingReport"
    [nzData]="participants"
    nzSize="middle"
    nzTableLayout="fixed"
  >
    <thead>
      <tr>
        <th>Offer ID</th>
        <th>Contractor</th>
        <th>Price</th>
        <th>Submitted at</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let participant of participants">
        <td>{{ participant.OfferId }}</td>
        <td>{{ participant.Username || ('Contractor #' + participant.UserId) }}</td>
        <td>{{ participant.PriceOffer | number }}</td>
        <td>{{ participant.Date | date: 'yyyy-MM-dd HH:mm' }}</td>
      </tr>
    </tbody>
  </nz-table>
</div>
